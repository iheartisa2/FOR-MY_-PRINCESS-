<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>iPhone Lyrics - Nostalgic Burn Edition</title>
<style>
:root {
  --phone-w: 390px;
  --phone-h: 844px;
  --ios-blue: #007AFF;
  --ios-pink: #FF2D78;
  --burn-orange: #ff4d00;
  --fire-gradient: linear-gradient(135deg, #FF2D78 0%, #007AFF 100%);
}

* { box-sizing: border-box; margin: 0; padding: 0; outline: none; }

body {
  height: 100vh;
  background: #080808;
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
}

/* Film Grain Overlay */
body::before {
  content: "";
  position: absolute;
  inset: 0;
  background: url('https://upload.wikimedia.org/wikipedia/commons/7/76/1k_Grain_Noise.jpg');
  opacity: 0.04;
  pointer-events: none;
  z-index: 1000;
}

/* Phone Frame */
.phone {
  width: var(--phone-w);
  height: var(--phone-h);
  background: #000;
  border-radius: 54px;
  border: 11px solid #1a1a1a;
  position: relative;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  box-shadow: 0 0 80px rgba(0,0,0,1);
  transition: all 0.4s cubic-bezier(0.2, 1, 0.2, 1);
}

.love-active {
  transform: scale(1.02);
  filter: contrast(1.1) brightness(1.1);
  box-shadow: 0 0 50px rgba(255, 45, 120, 0.3);
  border-color: var(--ios-pink) !important;
}

@keyframes burnIn {
  0% {
    clip-path: circle(0% at 50% 50%);
    filter: brightness(2) contrast(2) sepia(1) hue-rotate(-20deg);
    box-shadow: inset 0 0 20px var(--burn-orange);
  }
  100% {
    clip-path: circle(150% at 50% 50%);
    filter: brightness(1) contrast(1) sepia(0);
    box-shadow: inset 0 0 0px transparent;
  }
}

.bubble {
  max-width: 72%;
  padding: 10px 16px;
  border-radius: 20px;
  font-size: 17px;
  line-height: 1.35;
  color: #d1d1d1;
  background: #1c1c1e;
  opacity: 0;
  align-self: flex-start;
  margin-bottom: 4px;
  position: relative;
}

.bubble.active {
  opacity: 1;
  animation: burnIn 0.8s ease-out forwards;
}

.bubble.love-bubble {
  background: linear-gradient(135deg, #FF2D78 0%, #7d1a3a 100%);
  color: #fff;
  font-weight: 600;
  text-shadow: 0 0 8px rgba(255,255,255,0.3);
}

.bubble.fire-bubble {
  background: var(--fire-gradient);
  color: #fff;
  font-weight: 700;
  box-shadow: 0 0 15px rgba(0, 122, 255, 0.4);
}

.heart {
  position: absolute;
  pointer-events: none;
  font-size: 20px;
  z-index: 1000;
  animation: heartFloat 2s ease-out forwards;
}

@keyframes heartFloat {
  0% { transform: translateY(0) scale(0); opacity: 1; }
  100% { transform: translateY(-100px) scale(1.5) rotate(20deg); opacity: 0; }
}

.status-bar {
  position: absolute; top: 14px; width: 100%; padding: 0 32px;
  display: flex; justify-content: space-between; font-size: 14px; color: white; z-index: 110;
}
.header {
  padding: 60px 16px 12px; background: rgba(10, 10, 10, 0.8);
  backdrop-filter: blur(20px); display: flex; flex-direction: column; align-items: center;
  border-bottom: 0.5px solid rgba(255,255,255,0.05); z-index: 50;
}
.avatar {
  width: 48px; height: 48px; border-radius: 50%;
  background: #333 url('test.png') center/cover; margin-bottom: 4px;
}
.chat { flex: 1; padding: 20px 14px; overflow-y: auto; display: flex; flex-direction: column; scrollbar-width: none; }
.footer { padding: 10px 14px 34px; background: #0a0a0a; display: flex; align-items: center; gap: 12px; }
.svg-blue { fill: var(--ios-blue); width: 24px; }
.svg-icon { fill: #444; width: 24px; }
.input-pill { flex: 1; height: 38px; border: 1px solid #222; border-radius: 20px; }

#overlay { position: absolute; inset: 0; background: #000; z-index: 200; display: flex; justify-content: center; align-items: center; }
</style>
</head>
<body>

<div class="phone" id="mainPhone">
  <div class="status-bar">
    <div id="currentTime">9:41</div>
    <div style="display:flex; gap:5px">
      <svg width="18" height="12" fill="white"><path d="M2 10h1v1H2v-1zm3-2h1v3H5V8zm3-2h1v5H8V6zm3-2h1v7h-1V4z"/></svg>
      <svg width="16" height="16" fill="white" viewBox="0 0 24 24"><path d="M12 21l-12-18h24z"/></svg>
      <svg width="25" height="12" fill="white"><rect x="1" y="1" width="20" height="10" rx="2" stroke="white" stroke-width="1" fill="none"/><rect x="3" y="3" width="14" height="6" rx="1" fill="white"/><path d="M22 4v4" stroke="white" stroke-width="2"/></svg>
    </div>
  </div>

  <div class="header">
    <div class="avatar"></div>
    <div style="color:white; font-size:13px; font-weight:600;">MY HANDSOME BOYYðŸ’ŒðŸŽ€</div>
  </div>

  <div class="chat" id="chat"></div>

  <div class="footer">
    <svg class="svg-blue" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"/></svg>
    <div class="input-pill"></div>
    <svg class="svg-icon" viewBox="0 0 24 24"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>
  </div>

  <div id="overlay">
    <button style="padding:15px 45px; border-radius:30px; font-weight:800; cursor:pointer;" onclick="run()">Open Message</button>
  </div>
</div>

<audio id="audio" src="test.mp3"></audio>

<script>
const audio = document.getElementById('audio');
const chat = document.getElementById('chat');
const phone = document.getElementById('mainPhone');
let cues = [];
let currentIndex = -1;

function updateClock() {
  const now = new Date();
  document.getElementById('currentTime').textContent = now.getHours() + ":" + now.getMinutes().toString().padStart(2, '0');
}
setInterval(updateClock, 1000);
updateClock();

async function run() {
  document.getElementById('overlay').style.display = 'none';
  try {
    const res = await fetch('test.srt');
    const text = await res.text();
    parseSRT(text);
    audio.play();
    sync();
  } catch(e) { console.error("Could not load SRT or Audio", e); }
}

function parseSRT(data) {
  const blocks = data.trim().split(/\n\s*\n/);
  cues = blocks.map(b => {
    const lines = b.split('\n');
    const timeLine = lines.find(l => l.includes(' --> '));
    if(!timeLine) return null;
    return { start: parseTime(timeLine.split(' --> ')[0]), text: lines.slice(lines.indexOf(timeLine) + 1).join(' ') };
  }).filter(c => c !== null);
}

function parseTime(t) {
  const [hms, ms] = t.split(',');
  const [h, m, s] = hms.split(':');
  return +h * 3600 + +m * 60 + +s + (+ms / 1000);
}

function spawnHearts(x, y, isFire) {
  for (let i = 0; i < 12; i++) {
    const h = document.createElement('div');
    h.className = 'heart';
    // Use red heart instead of black for better visibility
    h.innerHTML = isFire ? (Math.random() > 0.5 ? 'ðŸ’™' : 'ðŸ’—') : (Math.random() > 0.5 ? 'â¤ï¸' : 'ðŸ’—');
    h.style.left = x + (Math.random() * 60 - 30) + 'px';
    h.style.top = y + 'px';
    phone.appendChild(h);
    setTimeout(() => h.remove(), 2000);
  }
}

function addBubble(text) {
  document.querySelectorAll('.bubble').forEach(b => b.style.opacity = '0.2');
  
  const lowerText = text.toLowerCase();
  // Fixed trigger: captures "love", "loving", "loves", etc.
  const isLove = lowerText.includes("love");
  const isFire = lowerText.includes("fire");
  
  const b = document.createElement('div');
  b.className = 'bubble';
  if (isLove) b.classList.add('love-bubble');
  if (isFire) b.classList.add('fire-bubble');
  
  b.textContent = text;
  chat.appendChild(b);

  // Position hearts relative to the phone container
  setTimeout(() => {
    if (isLove || isFire) {
      phone.classList.add('love-active');
      const rect = b.getBoundingClientRect();
      const phoneRect = phone.getBoundingClientRect();
      
      const spawnX = rect.left - phoneRect.left + 50;
      const spawnY = rect.top - phoneRect.top;
      
      spawnHearts(spawnX, spawnY, isFire);
      setTimeout(() => phone.classList.remove('love-active'), 1200);
    }
  }, 50);

  requestAnimationFrame(() => b.classList.add('active'));
  chat.scrollTo({ top: chat.scrollHeight, behavior: 'smooth' });
}

function sync() {
  const now = audio.currentTime;
  for (let i = 0; i < cues.length; i++) {
    if (now >= cues[i].start && currentIndex < i) {
      currentIndex = i;
      addBubble(cues[i].text);
    }
  }
  if (!audio.paused) requestAnimationFrame(sync);
}
</script>
</body>
</html>
